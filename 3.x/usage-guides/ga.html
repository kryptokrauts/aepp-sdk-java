
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The official documentation of the aepp-sdk-java provided by kryptokrauts.com
">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.1.9">
    
    
      
        <title>Generalized Accounts - aepp-sdk-java</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#generalized-accounts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="aepp-sdk-java" class="md-header__button md-logo" aria-label="aepp-sdk-java" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            aepp-sdk-java
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Generalized Accounts
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/kryptokrauts/aepp-sdk-java/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kryptokrauts/aepp-sdk-java
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="aepp-sdk-java" class="md-nav__button md-logo" aria-label="aepp-sdk-java" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    aepp-sdk-java
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/kryptokrauts/aepp-sdk-java/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kryptokrauts/aepp-sdk-java
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sdk-initialization.html" class="md-nav__link">
        SDK initialization
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      <label class="md-nav__link" for="__nav_3">
        Usage Guides
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Usage Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Usage Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="aens.html" class="md-nav__link">
        æternity naming system
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="contracts.html" class="md-nav__link">
        Contracts
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Generalized Accounts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="ga.html" class="md-nav__link md-nav__link--active">
        Generalized Accounts
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
    <nav class="md-nav" aria-label="Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecdsaauth-contract" class="md-nav__link">
    ECDSAAuth contract
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attach-the-generalized-account" class="md-nav__link">
    Attach the Generalized Account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#perform-a-meta-transaction-for-the-ga" class="md-nav__link">
    Perform a meta transaction for the GA
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-examples" class="md-nav__link">
    Additional examples
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="mdw.html" class="md-nav__link">
        Middleware
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="oracles.html" class="md-nav__link">
        Oracles
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="payingfortx.html" class="md-nav__link">
        PayingForTx
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../example-apps.html" class="md-nav__link">
        Example applications
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://www.javadoc.io/doc/com.kryptokrauts/aepp-sdk-java" class="md-nav__link">
        Javadoc
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../changelog.html" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contribute.html" class="md-nav__link">
        Contribute
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
    <nav class="md-nav" aria-label="Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecdsaauth-contract" class="md-nav__link">
    ECDSAAuth contract
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attach-the-generalized-account" class="md-nav__link">
    Attach the Generalized Account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#perform-a-meta-transaction-for-the-ga" class="md-nav__link">
    Perform a meta transaction for the GA
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-examples" class="md-nav__link">
    Additional examples
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/kryptokrauts/aepp-sdk-java/edit/master/docs/usage-guides/ga.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="generalized-accounts">Generalized Accounts</h1>
<h2 id="introduction">Introduction</h2>
<p><a href="https://aeternity.com/protocol/generalized_accounts/index.html">Generalized Accounts</a> (GAs) are mainly a way to give more flexibility when it comes to transaction integrity, in particular when it comes to signing. This is done by moving both the nonce handling and signature checking to a smart contract that is attached to the account.</p>
<h2 id="example">Example</h2>
<h3 id="ecdsaauth-contract">ECDSAAuth contract</h3>
<p>The following contract can be used in order to make the æternity account a GA that expects transactions
to be signed with the Elliptic Curve Digital Signature Algorithm known from Ethereum. This way you can for example use
your Ethereum private key in order to sign transactions on æternity.</p>
<div class="highlight"><pre><span></span><code><span class="k">contract</span><span class="w"> </span><span class="nf">ECDSAAuth</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">  </span><span class="k">record</span><span class="w"> </span><span class="nb">state</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">nonce</span><span class="w"> </span><span class="ow">:</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="ow">:</span><span class="w"> </span><span class="kt">bytes</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">entrypoint</span><span class="w"> </span><span class="n">init</span><span class="p">(</span><span class="n">owner&#39;</span><span class="w"> </span><span class="ow">:</span><span class="w"> </span><span class="kt">bytes</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">nonce</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">owner&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">stateful</span><span class="w"> </span><span class="k">entrypoint</span><span class="w"> </span><span class="n">authorize</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="ow">:</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="ow">:</span><span class="w"> </span><span class="kt">bytes</span><span class="p">(</span><span class="mi">65</span><span class="p">))</span><span class="w"> </span><span class="ow">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">    </span><span class="nb">require</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="ow">&gt;=</span><span class="w"> </span><span class="nb">state</span><span class="p">.</span><span class="n">nonce</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Nonce too low&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nb">require</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="ow">=&lt;</span><span class="w"> </span><span class="nb">state</span><span class="p">.</span><span class="n">nonce</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Nonce too high&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nb">put</span><span class="p">(</span><span class="nb">state</span><span class="p">{</span><span class="w"> </span><span class="n">nonce</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="ow">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="k">switch</span><span class="p">(</span><span class="nc">Auth</span><span class="p">.</span><span class="n">tx_hash</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="nf">None</span><span class="w">          </span><span class="ow">=&gt;</span><span class="w"> </span><span class="nb">abort</span><span class="p">(</span><span class="s2">&quot;Not in Auth context&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="nf">Some</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="nc">Crypto</span><span class="p">.</span><span class="n">ecverify_secp256k1</span><span class="p">(</span><span class="n">to_sign</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="nb">state</span><span class="p">.</span><span class="n">owner</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"></span>

<span class="w">  </span><span class="k">entrypoint</span><span class="w"> </span><span class="n">to_sign</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="ow">:</span><span class="w"> </span><span class="kt">hash</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="ow">:</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="ow">:</span><span class="w"> </span><span class="kt">hash</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">    </span><span class="nc">Crypto</span><span class="p">.</span><span class="n">blake2b</span><span class="p">((</span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"></span>

<span class="w">  </span><span class="k">entrypoint</span><span class="w"> </span><span class="n">get_nonce</span><span class="p">()</span><span class="w"> </span><span class="ow">:</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">    </span><span class="nb">state</span><span class="p">.</span><span class="n">nonce</span><span class="w"></span>

<span class="w">  </span><span class="k">entrypoint</span><span class="w"> </span><span class="n">get_owner</span><span class="p">()</span><span class="w"> </span><span class="ow">:</span><span class="w"> </span><span class="kt">bytes</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="ow">=</span><span class="w"></span>
<span class="w">    </span><span class="nb">state</span><span class="p">.</span><span class="n">owner</span><span class="w"></span>
</code></pre></div>
<h3 id="attach-the-generalized-account">Attach the Generalized Account</h3>
<p>Before actually being able to use the Ethereum private key for signing you have to first attach the contract to the account
which makes it a GA.</p>
<p>Following code snippet shows how to achieve this:</p>
<div class="highlight"><pre><span></span><code><span class="n">String</span> <span class="n">ecdsaAuthSource</span> <span class="o">=</span> <span class="s">&quot;...&quot;</span><span class="p">;</span>
<span class="n">String</span> <span class="n">ethereumAddress</span> <span class="o">=</span> <span class="s">&quot;...&quot;</span><span class="p">;</span>

<span class="n">AccountResult</span> <span class="n">gaTestAccount</span> <span class="o">=</span>
  <span class="n">aeternityService</span><span class="p">.</span><span class="na">accounts</span><span class="p">.</span><span class="na">blockingGetAccount</span><span class="p">(</span><span class="n">gaAccountKeyPair</span><span class="p">.</span><span class="na">getAddress</span><span class="p">());</span>
<span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">gaTestAccount</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span> <span class="c1">// AccountResult(publicKey=ak_2V4Sgh4FRBaAGox9pkFgYBKFGjf4kKxyMumiT9RcvCCeSFiTpS, balance=10000000000000000000, nonce=0, payable=true, kind=basic, gaContractId=null, gaAuthenticationFunction=null)</span>

<span class="c1">// Ethereum address as bytes(20) in Sophia</span>
<span class="n">String</span> <span class="n">expectedEthereumAddress</span> <span class="o">=</span> <span class="n">ethereumAddress</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;0x&quot;</span><span class="p">,</span> <span class="s">&quot;#&quot;</span><span class="p">);</span>

<span class="c1">// encode the required calldata via http compiler</span>
<span class="n">StringResultWrapper</span> <span class="n">resultWrapper</span> <span class="o">=</span>
  <span class="n">aeternityService</span><span class="p">.</span><span class="na">compiler</span><span class="p">.</span><span class="na">blockingEncodeCalldata</span><span class="p">(</span>
      <span class="n">ecdsaAuthSource</span><span class="p">,</span> <span class="s">&quot;init&quot;</span><span class="p">,</span> <span class="n">SophiaTypeTransformer</span>
          <span class="p">.</span><span class="na">toCompilerInput</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="k">new</span> <span class="n">SophiaBytes</span><span class="p">(</span><span class="n">expectedEthereumAddress</span><span class="p">,</span> <span class="mi">20</span><span class="p">))),</span> <span class="kc">null</span><span class="p">);</span>
<span class="n">String</span> <span class="n">callData</span> <span class="o">=</span> <span class="n">resultWrapper</span><span class="p">.</span><span class="na">getResult</span><span class="p">();</span>

<span class="c1">// get bytecode via http compiler</span>
<span class="n">resultWrapper</span> <span class="o">=</span>
  <span class="n">aeternityService</span><span class="p">.</span><span class="na">compiler</span><span class="p">.</span><span class="na">blockingCompile</span><span class="p">(</span><span class="n">ecdsaAuthSource</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
<span class="n">String</span> <span class="n">code</span> <span class="o">=</span> <span class="n">resultWrapper</span><span class="p">.</span><span class="na">getResult</span><span class="p">();</span>

<span class="c1">// build the GAAttachTx</span>
<span class="n">GeneralizedAccountsAttachTransactionModel</span> <span class="n">gaAttachTx</span> <span class="o">=</span>
  <span class="n">GeneralizedAccountsAttachTransactionModel</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
      <span class="p">.</span><span class="na">authFun</span><span class="p">(</span><span class="n">EncodingUtils</span><span class="p">.</span><span class="na">generateAuthFunHash</span><span class="p">(</span><span class="s">&quot;authorize&quot;</span><span class="p">))</span>
      <span class="p">.</span><span class="na">callData</span><span class="p">(</span><span class="n">callData</span><span class="p">)</span>
      <span class="p">.</span><span class="na">code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
      <span class="p">.</span><span class="na">nonce</span><span class="p">(</span><span class="n">gaTestAccount</span><span class="p">.</span><span class="na">getNonce</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="n">ONE</span><span class="p">))</span>
      <span class="p">.</span><span class="na">ownerId</span><span class="p">(</span><span class="n">gaTestAccount</span><span class="p">.</span><span class="na">getPublicKey</span><span class="p">())</span>
      <span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="c1">// broadcast the tx to attach the GA</span>
<span class="n">aeternityService</span><span class="p">.</span><span class="na">transactions</span><span class="p">.</span><span class="na">blockingPostTransaction</span><span class="p">(</span>
      <span class="n">gaAttachTx</span><span class="p">,</span> <span class="n">gaAccountKeyPair</span><span class="p">.</span><span class="na">getEncodedPrivateKey</span><span class="p">());</span>

<span class="n">gaTestAccount</span> <span class="o">=</span>
  <span class="n">aeternityService</span><span class="p">.</span><span class="na">accounts</span><span class="p">.</span><span class="na">blockingGetAccount</span><span class="p">(</span><span class="n">gaAccountKeyPair</span><span class="p">.</span><span class="na">getAddress</span><span class="p">());</span>
<span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">gaTestAccount</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span> <span class="c1">// AccountResult(publicKey=ak_2V4Sgh4FRBaAGox9pkFgYBKFGjf4kKxyMumiT9RcvCCeSFiTpS, balance=9999915897000000000, nonce=1, payable=true, kind=generalized, gaContractId=ct_2m5omoYZCRMf4as85V6FW3LDENoBM4JnHgMoPKk6Xz41tb6617, gaAuthenticationFunction=authorize)</span>
</code></pre></div>
<p>Congratulations, you now have a GA and can sign transactions with your Ethereum private key!</p>
<p>Attention:</p>
<ul>
<li>Be aware, there is no way back if you made your account a GA!</li>
</ul>
<h3 id="perform-a-meta-transaction-for-the-ga">Perform a meta transaction for the GA</h3>
<p>Once the GA is attached you can perform a <code>GaMetaTx</code>.
The <code>GaMetaTx</code> can include any type of tx supported by the æternity protocol.
In this specific example we perform a simple <code>SpendTx</code>.
The important part is how to produce the right hash of the tx in combination with the nonce which needs to be signed. 
For this specific example a Sophia encoded tuple of a hash and an integer, which is also hashed, needs to be signed.
As <a href="https://aeternity.com/protocol/generalized_accounts/ga_explained.html#caveat-producing-the-right-hash">this is not trivial</a> we use the dry-run functionality of the node to get the correct hash from the contract by providing the tx-hash and the nonce in order to achieve that.</p>
<p>Note:</p>
<ul>
<li>To simplify this you could also just hash a concatenated String of tx-hash and nonce ;-)</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// send 1 AE</span>
<span class="n">UnitConversionService</span> <span class="n">unitConversionService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultUnitConversionServiceImpl</span><span class="p">();</span>
<span class="n">BigInteger</span> <span class="n">amountToSend</span> <span class="o">=</span> <span class="n">unitConversionService</span><span class="p">.</span><span class="na">toSmallestUnit</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">);</span>

<span class="c1">// create a new KeyPair for the recipient</span>
<span class="n">KeyPair</span> <span class="n">otherRecipient</span> <span class="o">=</span> <span class="n">keyPairService</span><span class="p">.</span><span class="na">generateKeyPair</span><span class="p">();</span>

<span class="c1">// build the inner SpendTx to be included in the GaMetaTx</span>
<span class="n">SpendTransactionModel</span> <span class="n">gaInnerSpendTx</span> <span class="o">=</span>
  <span class="n">SpendTransactionModel</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
      <span class="p">.</span><span class="na">sender</span><span class="p">(</span><span class="n">gaAccountKeyPair</span><span class="p">.</span><span class="na">getAddress</span><span class="p">())</span>
      <span class="p">.</span><span class="na">recipient</span><span class="p">(</span><span class="n">otherRecipient</span><span class="p">.</span><span class="na">getAddress</span><span class="p">())</span>
      <span class="p">.</span><span class="na">amount</span><span class="p">(</span><span class="n">amountToSend</span><span class="p">)</span>
      <span class="p">.</span><span class="na">payload</span><span class="p">(</span><span class="s">&quot;spent using a generalized account with Ethereum signature =)&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="na">nonce</span><span class="p">(</span><span class="n">ZERO</span><span class="p">)</span> <span class="c1">// GA inner tx requires 0 as nonce</span>
      <span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="c1">// compute the correct hash for the inner tx</span>
<span class="n">String</span> <span class="n">txHash</span> <span class="o">=</span> <span class="n">aeternityService</span><span class="p">.</span><span class="na">transactions</span><span class="p">.</span><span class="na">computeGAInnerTxHash</span><span class="p">(</span><span class="n">gaInnerSpendTx</span><span class="p">);</span>

<span class="c1">// call the &quot;to_sign&quot; entrypoint to get the correct hash to sign from the contract</span>
<span class="n">Object</span> <span class="n">toSignResult</span> <span class="o">=</span> <span class="n">aeternityService</span><span class="p">.</span><span class="na">transactions</span>
            <span class="p">.</span><span class="na">blockingReadOnlyContractCall</span><span class="p">(</span><span class="n">gaTestAccount</span><span class="p">.</span><span class="na">getGaContractId</span><span class="p">(),</span> <span class="s">&quot;to_sign&quot;</span><span class="p">,</span>
                <span class="n">ecdsaAuthSource</span><span class="p">,</span> <span class="n">ContractTxOptions</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">params</span><span class="p">(</span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
                    <span class="k">new</span> <span class="n">SophiaHash</span><span class="p">(</span><span class="n">txHash</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="p">.</span><span class="na">build</span><span class="p">());</span>

<span class="c1">// remove the Sophia prefix &quot;#&quot; from the hash and decode it </span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">toSign</span> <span class="o">=</span> <span class="n">Hex</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="n">toSignResult</span><span class="p">.</span><span class="na">toString</span><span class="p">().</span><span class="na">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="c1">// sign the hash e.g. using web3j</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">signedTxHashWithNonce</span> <span class="o">=</span> <span class="n">web3jSignMessage</span><span class="p">(</span><span class="n">toSign</span><span class="p">,</span> <span class="n">credentials</span><span class="p">.</span><span class="na">getEcKeyPair</span><span class="p">());</span>

<span class="c1">// encode the require authData using the http compiler</span>
<span class="n">String</span> <span class="n">authData</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">aeternityService</span><span class="p">.</span><span class="na">compiler</span>
    <span class="p">.</span><span class="na">blockingEncodeCalldata</span><span class="p">(</span><span class="n">ecdsaAuthSource</span><span class="p">,</span> <span class="s">&quot;authorize&quot;</span><span class="p">,</span> <span class="n">SophiaTypeTransformer</span>
        <span class="p">.</span><span class="na">toCompilerInput</span><span class="p">(</span>
            <span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">new</span> <span class="n">SophiaBytes</span><span class="p">(</span><span class="n">Hex</span><span class="p">.</span><span class="na">toHexString</span><span class="p">(</span><span class="n">signedTxHashWithNonce</span><span class="p">),</span> <span class="mi">65</span><span class="p">))),</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">.</span><span class="na">getResult</span><span class="p">();</span>

<span class="c1">// build the GaMetaTx</span>
<span class="n">GeneralizedAccountsMetaTransactionModel</span> <span class="n">gaMetaTx</span> <span class="o">=</span>
    <span class="n">GeneralizedAccountsMetaTransactionModel</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
        <span class="p">.</span><span class="na">gaId</span><span class="p">(</span><span class="n">gaAccountKeyPair</span><span class="p">.</span><span class="na">getAddress</span><span class="p">())</span>
        <span class="p">.</span><span class="na">authData</span><span class="p">(</span><span class="n">authData</span><span class="p">)</span>
        <span class="p">.</span><span class="na">innerTxModel</span><span class="p">(</span><span class="n">gaInnerSpendTx</span><span class="p">)</span>
        <span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="c1">// broadcast the tx</span>
<span class="n">aeternityService</span><span class="p">.</span><span class="na">transactions</span><span class="p">.</span><span class="na">blockingPostTransaction</span><span class="p">(</span><span class="n">gaMetaTx</span><span class="p">);</span>
</code></pre></div>
<h2 id="additional-examples">Additional examples</h2>
<p>We also created a simple <strong>GaMultiSig</strong> example in our <a href="https://github.com/kryptokrauts/contraect-showcase-maven">contract-maven-showcase</a> repository.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="contracts.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Contracts" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Contracts
            </div>
          </div>
        </a>
      
      
        
        <a href="mdw.html" class="md-footer__link md-footer__link--next" aria-label="Next: Middleware" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Middleware
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["content.tabs.link", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.82b56eb2.min.js"></script>
      
    
  </body>
</html>